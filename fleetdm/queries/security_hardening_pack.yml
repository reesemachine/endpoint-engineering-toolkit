# Example osquery pack for security hardening checks.

name: security_hardening_pack
platform: "darwin,windows"
description: >
  Basic security posture checks for encryption, firewall,
  local admin accounts, and OS patching.

queries:
  disk_encryption_status:
    query: |
      SELECT
        hostname,
        platform,
        CASE
          WHEN platform = 'darwin' THEN
            (SELECT encryption_status FROM disk_encryption)
          WHEN platform = 'windows' THEN
            (SELECT protection_status FROM bitlocker_info)
          ELSE 'unknown'
        END AS encryption_status
      FROM system_info;
    interval: 3600
    snapshot: true
    removed: false

  firewall_status:
    query: |
      SELECT
        si.hostname,
        si.platform,
        CASE
          WHEN si.platform = 'darwin' THEN
            (SELECT
               CASE
                 WHEN global_state = 1 THEN 'Enabled'
                 ELSE 'Disabled'
               END
             FROM alf)
          WHEN si.platform = 'windows' THEN
            (SELECT
               CASE
                 WHEN enabled = 1 THEN 'Enabled'
                 ELSE 'Disabled'
               END
             FROM windows_firewall)
          ELSE 'Unknown'
        END AS firewall_status
      FROM system_info si;
    interval: 3600
    snapshot: true
    removed: false

  local_admin_accounts:
    query: |
      SELECT
        si.hostname,
        u.username,
        u.uid,
        u.gid,
        u.description
      FROM users u
      JOIN system_info si
      WHERE u.uid = 0
         OR u.username IN (
             SELECT username
             FROM user_groups
             WHERE groupname IN ('admin', 'Administrators')
         );
    interval: 7200
    snapshot: true
    removed: false

  outdated_os_versions:
    query: |
      SELECT
        hostname,
        platform,
        os_version,
        CASE
          WHEN platform = 'darwin'  AND os_version < '13.0.0' THEN 'Outdated macOS'
          WHEN platform = 'windows' AND os_version < '10.0.19045' THEN 'Outdated Windows'
          ELSE 'OK'
        END AS status
      FROM os_version;
    interval: 86400
    snapshot: true
    removed: false
